# TCP
## 1. 신뢰성있는 전송의 원리
- rdt-2 프로토콜 

	- 전송 후 대기 프로토콜 

	- ACK또는 NAK 패킷이 손상될 수 있다는 가능성을 고려하지 않아 결함이 있다.
- 체크섬 
	- 전송된 패킷 안의 비트 오류를 발견하는 데 사용된다.
- 타이머
	- 채널 안에서 패킷이 손실되었기 때문에 발생되는 패킷의 타임아웃/재전송에 사용된다. 

	- 타이머는 패킷이 손실된 경우와 패킷이 지연된 경우로 중복된 패킷이 재전송 될 수 있다.
- 순서번호
	-  송신자에서 수신자로 가는 데이터 패킷의 순서번호를 붙이기 위해서 사용된다.
- 확인응답
	- 패킷 또는 집합이 정확히 수신되었다는 응답을 송신자에게 하기위해 수신자에 의해서 사용된다. 
- 윈도우, 파이프라이닝
	- 송신자는 주어진 범위에 있는 순서번호를 가진 패킷만 전송하도록 제한될 수 있다.  
## 2. GBN과 SR
- Go-Back-N

	- 송신자는 확인응답을 기다리지 않고 여러 패킷을 전송할 수 있다.
	- 그러나 파이프라인에서 윈도우 크기 보다 작을 때 까지만 가능하다.


	- 타임아웃이 발생한다면 송신자는 이전에 전송되었지만 아직 확인 응답 되지 않은 모든 패킷을 다시 전송한다.
	- 예를 들어 1, 2, 3, 4 순서로 패킷을 보냈는데 수신자로부터 1번 패킷은 확인 응답을 받고 3, 4도 받았지만 수신자는 2번을 받지 않았으므로 2번에 대한 타임 아웃으로 2, 3, 4를 다시 전송한다.
- Selective-Repeat 
	- 수신자에서 오류가 발생한 패킷을 수신했다고 의심되는 패킷만을 송신자가 다시 전송하므로 불필요한 재전송을 피한다.

	- 오류가 발생했다고 의심되는 패킷보다 순서번호가 높은 패킷들은 따로 버퍼에 저장된다.
## 3. TCP 세그먼트 구조
- 순서 번호 필드  
	- 일련의 전송된 세그먼트에 대해서가 아니라 전송된 바이트 스트림에 대한 것이다.
- 확인 응답 번호

	- 수신된 순서번호 필드에 1을 더한 값을 송신자에게 보낸다.
- 플래그 필드 6비트
	- RST, SYN, FIN, ACK, PSH등이 있다.
- 수신 윈도우
	- 흐름제어에 사용되는 필드로 수신자가 받아들이려는 바이트의 크기를 나타낸다.

## 4. 흐름 제어
- rwnd

	- rwnd는 수신 버퍼에 여유 공간이다.
- 수신자는 송신자에게 자신의 rwnd를 세그먼트에 담아 보낸다.
- 송신자는 rwnd를 보고 남아있는 공간이 0이면 전송을 하지 않는다.
## 5.  3-WAY-HANDSHAKE
- 1단계 
	- 클라이언트는 서버에게 SYN 세그먼트를 보낸다.

	- SYN 세그먼트는 TCP 헤더에 SYN 필드 비트가 1이다

- 2단계
	- 서버는 클라이언트에게 SYN 세그먼트를 받은 후 연결에 TCP버퍼와 변수들을 할당한다.

	- 그리고 클라이언트에게 연결 승인 세그먼트를 송신한다.
	- 연결 승인 세그먼트 헤더 안에는 3개의 중요한 정보를 포함한다.
		- SYN 비트는 1로 설정한다.

		- 헤더의 확인응답 필드는 클라이언트에게 받은 순서필드 + 1이다.
		- 서버는 순서번호 필드에 자신의 최초의 순서번호를 넣는다.

- 3단계
	- 클라이언트는 연결 승인 세그먼트를 수신하면 버퍼와 변수들을 할당한다.
	- SYN 비트를 0으로 설정하고 확인응답 필드에 서버에게 받은 순서 필드 + 1을 입력한 세그먼트를 서버에게 송신한다.

	- 3단계에서는 데이터가 운반될 수 있는데 1, 2단계는 데이터는 없고 헤더만 있는 세그먼트가 전송된다.

## 6.  혼잡 제어
- 혼잡제어는 네트워크 혼잡을 피하기 위해서 송신자가 전송률을 제한하는 것이다.

- 혼잡 윈도우 (cwnd)
	- 혼잡 윈도우는 TCP 송신자가 네트워크로 트래픽을 전송할 수 있는 비율을 제한한다.
- 혼잡 제어 알고리즘
	- 슬로 스타트
		- TCP 연결이 시작될 때, cwnd의 값은 일반적으로 1로 초기화된다.
		- cwnd의 값은 확인응답을 받을 때마다 1씩 증가한다.
		- 처음에 1개 세그먼트를 보내고 응답을 보내면 cwnd는 2가되고 이제 2개를 보내면 2개에 대한 개별 응답의 1을 증가시키면 2가 증가되고 cwnd는 4가 된다.
		- 위의 예처럼 cwnd는 지수적으로 증가한다.`1, 2, 4, 8, 16`
		- 지수적 증가는 타임 아웃에 대한 손실 이벤트가 발생했을때 종료된다. 
		- 그러면 다시 cwnd를 1로 초기화하고 ssthresh(slow start threshold)값을 손실 발생 전에 cwnd값의 반으로 설정한다.

		- cwnd가 ssthresh값이 되기 전까지는 지수적으로 증가하다가 값이 같아지면 혼잡 회피 모드로 전환된다.

	- 혼잡 회피
		- 혼잡 회피모드는 cwnd의 값을 RTT마다 1씩 증가한다.
		- 예를 들어 MSS(Maximum segment size)가 10이고 cwnd가 100일때 10개의 세그먼트가 한 RTT내의 송신 될수 있다.
		- 개별 ACK마다 1/10 씩 증가시키면 10개의 세그먼트를 ACK했을 때 1이 증가하게 된다.

		- 혼잡 회피의 선형 증가는 타임 아웃이 발생되었을 때 끝난다.
		- 타임 아웃이 발생되면 cwnd는 1로 초기화하고 ssthresh의 값을 손실 이전의 cwnd의 반으로 설정한다.
		- 중복된 3개의 ACK이 왔을 때는 타임 아웃보다 덜 심각한 상황이므로 TCP는 cwnd의 값을 반으로 설정하고 ssthresh의 값을 중복된 3개의 ACK시점에 cwnd값의 반으로 설정하고 빠른 회복 상태로 들어간다.
	- 빠른 회복
		- 빠른 회복에서는 ACK를 수신할 때마다 cwnd를 1씩 증시키고 타임 아웃이 났을 때는 슬로우 스타트 처럼 cwnd를 1로 초기화하고 ssthresh를 타임 아웃 시점의 cwnd의 값을 설정한 후 슬로우 스타트 단계로 들어간다.	
	